# Оформление PR и code review

[Общие требования к принятию PR](#Общие-требования-к-принятию-pr)

[Общие требования к оформлению PR](#Общие-требования-к-оформлению-pr)

[Порядок проверки PR фронтов](#Порядок-проверки-pr-фронтов)

[Когда звать фронтового руководителя](#Когда-звать-фронтового-руководителя)

[Полезные ссылки](#Полезные-ссылки)

## Общие требования к принятию PR

Что сделать, чтобы ваш PR был принят быстро и с первого раза:
- В описании к PR должна содержаться ссылка на задачу JIRA, если такая задача есть
- Перед тем как оформить PR проверьте стилистическое оформление кода
  - Лишние пробелы
  - Форматирование многострочных конструкций
  - Форматирование сложных конструкций
- Декомпозируйте, декомпозируйте и еще раз декомпозируйте
  - Еще раз взгляните на куски кода - видите, что сложно выглядит - первый сигнал к декомпозиции
  - Не можете протестировать метод – значит, он написан плохо - декомпозируйте
  - Проблемы в личной жизни - декомпозируйте код
- Называйте переменные и методы так, чтобы через день, вспомнить, что они значат
  - Именование стоит делать не как быстрее, а как понятнее, даже если это набросок (нет ничего более постоянного, чем временное)
  - Непонятные имена методов только усложняют разработку тебе самому
- Используйте только I18n. Это упростит жизнь в будущем
  - При переносе кода в плагин, вам придется это сделать, потому что у вас в проекте это платья, а где-то это трубы
  - Интернационализация должна использоваться везде, от контроллеров и моделей, до вьюшек
- Если вы изменяли хранимки в БД, обязательно положите их под гит, сначала положите, потом измените (отдельными коммитами)
  - Это упростит конфликты при изменении двумя людьми одной и той же хранимки
  - Это внесет ясность, при сложных обновлениях, пришедших с других проектов
- Всегда пишите тесты на свой код
- Проверяйте недочеты по всем файла из PR
  - Если вам в каком-то файле отметили недочет - обязательно проверьте все файлы PR на этот недочет, скорее всего - он не один такой
  - Очень полезно смотреть на свой PR глобально, лучше всего подходит GH
- Комментируйте проделанную работу
  - На данный момент нужно использовать TomDoc
  - Начните с описания того, что делает тот или иной модуль, класс, метод

## Общие требования к оформлению PR
- PR обязательно должен быть просмотрен хотя бы одним разработчиком проекта, отличным от автора
- Проверяющий должен оставить подтверждение проверки в виде комментария к PR
- Должны пройти тесты
- Должны быть исправлены или согласованы все комментарии по оформлению кода (Hound)
- Все изменения которые производит автор после начала процесса ревью, должны быть сделаны в виде отдельных коммитов.
- После завершения процесса ревью и согласования, проверающий дает команду на rebase.
- Разработчик делает rebase, обновляет реквест, дает сигнл принимающему.
- Ответственный за репозиторий, принимает реквест
- По умолчанию, ответственным за репозиторий проекта является тимлид, он принимает реквест
- По умолчанию, достаточно одного ОК тимлдида
- В проекте, тимлид может устанавливать дополнительные правила принятия реквестов, согласовав их с командой и ПМом
- Тимлид может добавлять других членов команды в список ответственных за репозиторий. В этом случае они получают право принимать реквесты.

Требования распространяются на любые PR в проект. PR не может быть принят в случае несоответствия требованиям к принятию PR. Ответственность за принятие PR несоответствующего требованиям несет человек, принявший PR.

## Порядок проверки PR фронтов
Для оптимизации проверок и пропускания наименьшего количества ошибок, во врине у фронтендеров организована
круговая проверка PR.

:warning: Раздел является дополнением к описанным выше общим правилам :warning:

**Текущая схема проверок:**

*Старшие фронты*

| Автор реквеста | Проверяющий | Утверждающий | Запасной |
| --- | --- | --- | --- |
| Быченкова Людмила | Коваленко Кирилл | Кузнецова Гузель | любой старший по договоренности |
| Кузнецова Гузель | Смирнов Иван | Быченкова Людмила | любой старший по договоренности |
| Леонтьев Кирилл | Большаков Иван | Горшков Иван | любой старший по договоренности |
| Горшков Иван | Левушкина Марина | Зуева Анастасия | любой старший по договоренности |
| Зуева Анастасия | Владимирова Виктория | Леонтьев Кирилл | любой старший по договоренности |

*Остальные фронты*

| Автор реквеста | Проверяющий | Утверждающий | Запасной |
| --- | --- | --- | --- |
| Левушкина Марина | Большаков Иван | Горшков Иван | Кузнецова Гузель |
| Коваленко Кирилл | Овечкин Егор | Кузнецова Гузель | Быченкова Людмила |
| Козырь Ксения | Леванова Евгения | Быченкова Людмила | Зуева Анастасия |
| Большаков Иван | Левушкина Марина | Быченкова Людмила | Горшков Иван |
| Овечкин Егор | Большаков Иван | Зуева Анастасия | Горшков Иван |
| Тарасов Кирилл | Козырь Ксения | Горшков Иван | Кузнецова Гузель |
| Леванова Евгения | Тарасов Кирилл | Горшков Иван | Кузнецова Гузель |
| Владимирова Виктория (реакт) | Русских Михаил | Леонтьев Кирилл | Быченкова Людмила |
| Владимирова Виктория (не реакт) | Русских Михаил | Быченкова Людмила | Зуева Анастасия |
| Русских Михаил | Владимирова Виктория | Зуева Анастасия | Леонтьев Кирилл |
| Смирнов Иван | Коваленко Кирилл | Кузнецова Гузель | Быченкова Людмила |

Если PR задевает **меньше 25 строк**, достаточно получить **только 1 ок от утверждающего**.

Срок первой реакции проверяющих и утверждающих - **24 часа**.

**В тех случаях, когда бэкэнд-разработчик задевает вьюхи или другие фронтовые части,
схема проверки следующая:**
- Проверяющий - один из младших фронтэнд разработчиков (по ситуации).
- Утверждающий - в зависимости от проекта старший фронтенд разработчик.

**Список понятий:**

- *Автор реквеста* - тут всё понятно.

- *Проверяющий* - тот, кто проверяет первый раз. Находим ошибки, вызываем утверждающего.
Ждать, пока автор их исправит, не нужно. Ваша часть сделана.

- *Утверждающий* - проверяет ещё раз, если ошибки есть - пишет в реквесте, что ошибки можно править.
Если нет, то апрувает реквест.

- *Запасной* - заменяет только *утверждающего.*

**(!) Если кто-то из проверяющих не может посмотреть**, передайте реквест любому фронтенд-разработчику,
который не входит в список утверждающих.

## Когда звать фронтового руководителя
В ряде случаев возникает необходимость звать руководителя группы фронт-энд разработки в реквесты.

- **Задачи после проектирования, где, помимо ОКа, есть коммент, что надо звать в реквест.**
Если есть мнение, что задача достаточно сложная/важная и руководитель группы фронтов оставил коммент,
что его надо позвать в реквест по этой задаче.

- **Любые задачи с крупным рефакторингом**
Необходимость проверки таких реквестов возникает потому, что сам по себе крупный рефакторинг не проектировался
(иначе бы попал под пункт 1. Это, в свою очередь, создает вопрос правильно ли он сделан, так как нет смысла убирать
один тех.долг, чтобы создать другой.

- **Если в реквесте спорный вопрос, который не могут решить на протяжении двух дней**
Чтобы не тормозить задачу еще дольше, руководитель приходит и решает спор.

- **Если задача делалась значительно дольше времени, чем планировалось (+2 дня).**
Если задача делалась значительно дольше времени, чем планировалось, значит задача не такая простая, какой её оценили
на этапе планирования. В таком случае решение попадает в определенную зону риска. Задачу могли плохо реализовать,
либо она настолько сложная, что ей требовалось проектирование.

- **Любое внедрение новых решений, которые каким-то образом не были спроектированы**
Сюда входит внедрение любых решений, которые “сделают разработку лучше/проще/дешевле”. Любое добавление каких-то
сторонних компонентов итд итп. Любое изменение межпроектных стилей/кода.

По умолчанию на проверку реквестов, соответствующих перечисленным требованиям, зовёт разработчик, сделавший реквест.
Но также может призвать и тот, кто обладает правами мержа в соответствуеющий репозиторий.

## Полезные ссылки
- [Как писать отличные пулл-реквесты](http://habrahabr.ru/post/248527/)
- [Как создать идеальный Pull Request](https://habrahabr.ru/company/Voximplant/blog/279703/)
- [Пулл-реквесты с эмпатией](https://habrahabr.ru/company/mobileup/blog/340456/)

В большинстве вопросов мы принимаем правила, описанные
в [Thougtbot Guides](https://github.com/thoughtbot/guides/tree/master/code-review).