# Методы отладки кода

Раздел содержит т.н. tips & tricks & best practices по отладке кода Ruby в частности Rails-приложений и тестов Rspec.

## Литература и вспомогательные ссылки
- [I am a puts debuggerer](https://tenderlovemaking.com/2016/02/05/i-am-a-puts-debuggerer.html)
- [Wiki по инструменту Pry](https://github.com/pry/pry/wiki)
- [Pry screencast](https://vimeo.com/26391171)
- [Документация по pry-debugger'у](https://github.com/nixme/pry-debugger/blob/master/README.md)
- [Статья о исползовании Pry-debugger'а](http://www.jackkinsella.ie/2014/06/06/debugging-rails-with-pry-debugger.html)


Для отладки rails-приложения или вашего гема используем гем pry-debugger.
Его необходимо подключить в ваш проект, указав зависимость в Gemfile или в gemspec файле.

```ruby
# в .gemspec
spec.add_development_dependency 'pry-debugger'

# в Gemfile:
gem 'pry-debugger'
```

Отладка при помощи данного дебагера происходит интерактивно в консоли. Для начала, нам необходимо указать брейкпойнт (место, где выполнение кода остановится для отладки).
Это делается указанием такой строки прямо в коде:

```ruby
binding.pry          # Execution will stop here.
```

Либо можно использовать просто debug.

Если вы отлаживаете rails-приложение, то необходимо запустить сервер с поддержкой отладки:
```
rails s --debugger
```
(либо другую комманду с опцией --debugger, например ```rails c --debugger```)

Если вы отлажеваете написанный тест rspec, то необходимо запусить тесты с поддержкой отладки:

```
rspec path/to/your/spec --debugger для версии rspec 2
```
или
```
rspec path/to/your/spec -r pry (для версии 3)
```

Запускаем приложение (тесты), выполяем специфические действия, которые привевут к выполнению интресующей вас части кода.
Выполнение кода будет приостановлено в том месте, где вы это указали!

Вы перешли в интерактивный режим отладки кода, который позволяет:
 - просматривать значения всех переменных (просто напишите имя переменной и в интерактивном режимер в косоли увидите ее значение
 - выполнять вычисления (аналогично irb или rails c). для этого просто вводите код в консоль
 - управлять дальнейшим ходом выполенения приложения (введя одну из нескольких комманд):
   - с (continue)- продолжить выполнение приложения (обычно если вы уже прошли интересующий вас код и дальнейший дебаг вас не интересуюет)
   - s (step into) - выполнить один шаг отладки с заходом внутрь метода
   - n (step over) - выполнить один шал (1 строку кода)
   - b (breakpoint) - установить или снять брейкпойнт

Таким образом выполняя код пошагово вы можете выяснить причину, по которой он работает некорректно.

##Inspect

для отладки вам может быть полезен метод inspect, который выводи строковое представление для примитивных типов. Особенно это актуально для массивов и хешей.
```
variable.inspect
```

##Олдскульная отладка приложения (puts&raise)

Вы можете отлаживать приложение при помощи вывода значений интересуютщих переменных или выражений в консоль, или выбрасывая исключения из кода, когда что-то пойдет не так.
Но у данного подхода есть очевидные минусы:
 - вы не видите полной картины, значений остальных перменных, и вам сложно представить последовательность выполнения кода
 - для того, чтобы посмотреть другие переменные, выражения и т.д. вам необходимо перезапускать приложение (тесты)
 - вам нужно рыться в логе, чтобы найти выведенную вами и информацию

Но есть и плюс: такая отладка развивает креативное мышление и воображение :smile: Но не смотря на это рекомендуесчя использовать дебаггер.

## Дополнительные полезные инструменты
- [awesome_print](https://github.com/michaeldv/awesome_print) - pretty prints Ruby objects in full color exposing their internal structure with proper indentation
- pry-backtrace
- pry-rails
- pry-rescue

##P.S.
В Ruby >= 2.0 pry-debugger не работает или работает с багами, там рекомендуется использовать pry-byebug.
